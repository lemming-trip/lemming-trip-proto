syntax = "proto3";

package lemmingtrip.session;

import "google/protobuf/timestamp.proto";

message Session {
  string id = 1;
  string identity_id = 2;
  string session_token = 4;
  string ip_address = 5;
  string user_agent = 6;
  DeviceInfo device_info = 7;
  google.protobuf.Timestamp expires_at = 8;
  google.protobuf.Timestamp last_activity_at = 9;
  google.protobuf.Timestamp created_at = 10;
  google.protobuf.Timestamp revoked_at = 11;
  bool is_active = 12;

  message DeviceInfo {
    string device_id = 1;
    string device_type = 2;
    string os = 3;
    string app_version = 4;
    map<string, string> extra = 5;
  }
}

message GetSessionRequest {
  string session_id = 1;
}

message GetSessionResponse {
  Session session = 1;
}

message RevokeSessionRequest {
  string session_id = 1;
}

message RevokeSessionResponse {
  bool success = 1;
}

message ListSessionsRequest {
  string identity_id = 1;
  int32 take = 2;
  int32 skip = 3;
  string filter = 4;
  bool desc = 5;
}

message ListSessionsResponse {
  repeated Session sessions = 1;
  int32 total = 2;
}

message CreateSessionRequest {
  string identity_id = 1;
  Session.DeviceInfo device_info = 5;
}

message CreateSessionResponse {
  Session session = 1;
}

message RefreshSessionRequest {
  string session_token = 1;
}

message RefreshSessionResponse {
  Session session = 1;
}

message ValidateSessionRequest {
  string session_token = 1;
}

message ValidateSessionResponse {
  bool valid = 1;
}

message TerminateAllSessionsRequest {
  string identity_id = 1;
}

message TerminateAllSessionsResponse {
  int32 terminated_count = 1;
}

message GetActiveSessionsRequest {
  string identity_id = 1;
}

message GetActiveSessionsResponse {
  repeated Session sessions = 1;
}

message UpdateSessionActivityRequest {
  string id = 1;
  google.protobuf.Timestamp last_activity = 2;
}

message UpdateSessionActivityResponse {
  Session session = 1;
}
